import{escapeHtml}from"./utils.js";export class Carousel{constructor(e,t){this.featuredTools=e,this.container=t,this.inner=this.container.querySelector(".carousel-inner"),this.indicatorsContainer=this.container.querySelector(".carousel-indicators"),this.currentIndex=0,this.autoplayInterval=null,this.inner&&this.indicatorsContainer&&0!==this.featuredTools.length&&(this.render(),this.setupEventListeners(),this.startAutoplay())}render(){const e=this.inner.querySelector(".carousel-placeholder");e&&e.remove(),this.container.querySelectorAll(".carousel-control").forEach(e=>e.style.opacity="1"),this.inner.innerHTML="",this.indicatorsContainer.innerHTML="",this.featuredTools.forEach((e,t)=>{this.inner.appendChild(this.createCarouselItem(e,t)),this.indicatorsContainer.appendChild(this.createIndicator(t))}),this.update()}createCarouselItem(e,t){const i=document.createElement("div");return i.className="carousel-item",i.setAttribute("role","tabpanel"),i.setAttribute("aria-label",`Featured tool: ${e.title}`),e.background_image&&(i.style.backgroundImage=`linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.9) 100%), url(${e.background_image})`,i.style.backgroundSize="cover",i.style.backgroundPosition="center"),i.innerHTML=`\n            <div class="featured-content">\n                <div class="featured-text">\n                    <h2><i class="fas fa-rocket" aria-hidden="true"></i> Featured Tool</h2>\n                    <h3>${escapeHtml(e.title)}</h3>\n                    <p>${escapeHtml(e.featured_description||e.description)}</p>\n                    <div class="featured-actions">\n                        <a href="${e.url}" class="primary-btn" target="_blank" rel="noopener noreferrer" aria-label="Try it now: ${e.title}">\n                            <span>Try it now</span>\n                            <i class="fas fa-arrow-right" aria-hidden="true"></i>\n                        </a>\n                        <a href="#main-content" class="secondary-btn">Explore all tools</a>\n                    </div>\n                </div>\n                <div class="featured-visual">\n                    <div class="floating-card">\n                        <div class="card-icon"><i class="${e.icon}" aria-hidden="true"></i></div>\n                        <div class="card-content">\n                            <h4>${escapeHtml(e.title)}</h4>\n                            <p>AI-Powered Tool</p>\n                        </div>\n                    </div>\n                </div>\n            </div>`,i}createIndicator(e){const t=document.createElement("button");return t.className="indicator",t.setAttribute("role","tab"),t.setAttribute("aria-label",`Go to slide ${e+1}`),t.dataset.index=e,t.addEventListener("click",()=>this.goToSlide(e)),t}setupEventListeners(){this.container.querySelector(".carousel-control.prev")?.addEventListener("click",()=>this.previousSlide()),this.container.querySelector(".carousel-control.next")?.addEventListener("click",()=>this.nextSlide()),this.container.addEventListener("mouseenter",()=>this.pauseAutoplay()),this.container.addEventListener("mouseleave",()=>this.resumeAutoplay()),document.addEventListener("visibilitychange",()=>document.hidden?this.pauseAutoplay():this.resumeAutoplay()),this.setupKeyboardNavigation(),this.setupTouchNavigation()}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{e.target.matches("input, textarea, select")||("ArrowLeft"===e.key?(e.preventDefault(),this.previousSlide()):"ArrowRight"===e.key&&(e.preventDefault(),this.nextSlide()))})}setupTouchNavigation(){let e=0,t=!1;this.container.addEventListener("touchstart",i=>{e=i.touches[0].clientX,t=!0},{passive:!0}),this.container.addEventListener("touchend",i=>{if(!t)return;const r=i.changedTouches[0].clientX-e;Math.abs(r)>50&&(r>0?this.previousSlide():this.nextSlide()),t=!1},{passive:!0})}update(){this.inner.style.transform=`translateX(-${100*this.currentIndex}%)`,this.container.querySelectorAll(".carousel-item").forEach((e,t)=>{e.classList.toggle("active",t===this.currentIndex),e.setAttribute("aria-hidden",t!==this.currentIndex)}),this.container.querySelectorAll(".indicator").forEach((e,t)=>{e.classList.toggle("active",t===this.currentIndex),e.setAttribute("aria-selected",t===this.currentIndex)})}nextSlide(){this.currentIndex=(this.currentIndex+1)%this.featuredTools.length,this.update(),this.resetAutoplay()}previousSlide(){this.currentIndex=(this.currentIndex-1+this.featuredTools.length)%this.featuredTools.length,this.update(),this.resetAutoplay()}goToSlide(e){this.currentIndex=e,this.update(),this.resetAutoplay()}startAutoplay(){this.featuredTools.length<=1||(this.autoplayInterval=setInterval(()=>this.nextSlide(),6e3))}pauseAutoplay(){clearInterval(this.autoplayInterval),this.autoplayInterval=null}resumeAutoplay(){this.autoplayInterval||this.startAutoplay()}resetAutoplay(){this.pauseAutoplay(),this.resumeAutoplay()}}