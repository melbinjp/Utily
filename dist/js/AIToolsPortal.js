import{escapeHtml}from"./utils.js";export class AIToolsPortal{constructor(){this.tools=[],this.currentFilter="all",this.init()}async init(){this.showLoading(),this.setupThemeToggle();try{await this.loadTools(),this.renderToolGrid(),this.hideLoading(),this.setupFilters(),this.setupIntersectionObserver(),await this.lazyLoadCarousel()}catch(e){console.error("Failed to initialize portal:",e),this.showError("Failed to load AI tools. Please refresh the page."),this.hideLoading()}}async loadTools(){try{const e=await fetch("tools.json");if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();this.tools=t.filter(e=>e.show)}catch(e){throw console.error("Failed to load tools:",e),this.tools=[],e}}async lazyLoadCarousel(){const e=this.tools.filter(e=>e.featured);if(e.length>0){const{Carousel:t}=await import("./Carousel.js");new t(e,document.querySelector(".hero-carousel"))}else document.querySelector(".hero-carousel")?.remove()}showLoading(){document.getElementById("loading-indicator")?.classList.remove("hidden")}hideLoading(){const e=document.getElementById("loading-indicator");e&&setTimeout(()=>e.classList.add("hidden"),150)}showError(e){const t=document.createElement("div");t.className="error-message",t.innerHTML=`<div class="error-content"><i class="fas fa-exclamation-triangle"></i><p>${e}</p><button onclick="location.reload()">Retry</button></div>`,document.body.appendChild(t)}setupThemeToggle(){const e=document.querySelector(".theme-toggle"),t=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",t),this.updateThemeIcon(t),e?.addEventListener("click",()=>{const e="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),this.updateThemeIcon(e)})}updateThemeIcon(e){const t=document.querySelector(".theme-toggle i");t&&(t.className="dark"===e?"fas fa-sun":"fas fa-moon")}renderToolGrid(){const e=document.getElementById("tool-grid");e&&(e.querySelector(".tool-placeholder")?.remove(),e.innerHTML="",this.tools.forEach(t=>{e.appendChild(this.createToolCard(t))}))}createToolCard(e){const t=document.createElement("article");t.className="tool-card",t.dataset.category=this.getToolCategory(e),t.style.minHeight="200px";const o=document.createElement("template");return o.innerHTML=`\n            <div class="tool-card-header">\n                <div class="tool-card-icon"><i class="${e.icon}" aria-hidden="true"></i></div>\n                <h3><a href="${e.url}" target="_blank" rel="noopener noreferrer">${escapeHtml(e.title)}</a></h3>\n            </div>\n            <p>${escapeHtml(e.description)}</p>\n            <div class="tool-card-footer">\n                <a href="${e.url}" class="tool-card-link" target="_blank" rel="noopener noreferrer">Try it out <span class="sr-only">for ${escapeHtml(e.title)}</span><i class="fas fa-external-link-alt" aria-hidden="true"></i></a>\n            </div>`,t.appendChild(o.content.cloneNode(!0)),t.addEventListener("click",t=>{t.target.closest("a")||window.open(e.url,"_blank","noopener,noreferrer")}),t}getToolCategory(e){const t=e.title.toLowerCase(),o=e.description.toLowerCase();return t.includes("chat")||t.includes("ai")||o.includes("ai")||o.includes("transcription")?"ai":t.includes("audio")||t.includes("video")||t.includes("3d")||t.includes("voice")?"media":"utility"}setupFilters(){document.querySelectorAll(".filter-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.filter;this.setActiveFilter(t),this.filterTools(t)})})}setActiveFilter(e){document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active")),document.querySelector(`[data-filter="${e}"]`)?.classList.add("active"),this.currentFilter=e}filterTools(e){document.querySelectorAll(".tool-card").forEach(t=>{const o=t.dataset.category;t.classList.toggle("hidden",!("all"===e||o===e))})}setupIntersectionObserver(){const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.animation="fadeInUp 0.6s ease forwards",t.unobserve(e.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".tool-card").forEach(t=>e.observe(t))}}